(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{455:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>o});var r=t(5155),c=function(e){return e.SUCCESS="SUCCESS",e.FAILURE="FAILURE",e.OFFER="OFFER",e.ANSWER="ANSWER",e.MATCHED="MATCHED",e}({}),a=function(e){return e.SKIP="SKIP",e.SET_SENDER="SET_SENDER",e.SET_RECIEVER="SET_RECIEVER",e.OFFER="OFFER",e.ANSWER="ANSWER",e.ADD_ICE_CANDIDATES="ADD_ICE_CANDIDATES",e.FIND_NEXT="FIND_NEXT",e.STOP="STOP",e}({}),s=t(2115);function o(){let[e,n]=(0,s.useState)(!1),[t,o]=(0,s.useState)(!1),i=(0,s.useRef)(null),l=(0,s.useRef)(null),[d,u]=(0,s.useState)(null),[f,E]=(0,s.useState)(null),S=(0,s.useRef)(null),g=(0,s.useRef)(null),y=(0,s.useRef)(null),N=(0,s.useRef)(!1);function p(e){if(e)try{e.onicecandidate=null,e.ontrack=null,e.onnegotiationneeded=null,e.close()}catch(e){}}async function m(){await new Promise(e=>setTimeout(e,200)),console.log("partner skipped"),A(a.SKIP)}async function D(e){let t=await C();if(!t)return void console.log("no localStream");let r=new RTCPeerConnection;try{t.getTracks().forEach(e=>r.addTrack(e,t))}catch(e){console.log(e)}r.onicecandidate=e=>{let n=e.candidate;n&&S.current&&S.current.send(JSON.stringify({type:a.ADD_ICE_CANDIDATES,payload:{sdp:n,id:1}}))},r.onconnectionstatechange=()=>{console.log("connection state: "+r.connectionState),"connected"==r.connectionState&&n(!1)},g.current=r;let c=await g.current.createOffer();await g.current.setLocalDescription(c),e.send(JSON.stringify({type:a.OFFER,payload:{offer:c}}))}async function w(e,n){let t;y.current?t=y.current:((t=new RTCPeerConnection).ontrack=e=>{let n=new MediaStream;n.addTrack(e.streams[0].getAudioTracks()[0]),n.addTrack(e.streams[0].getVideoTracks()[0]),E(n),console.log("remote track addded")},t.onicecandidate=e=>{let t=e.candidate;t&&(n.send(JSON.stringify({type:a.ADD_ICE_CANDIDATES,payload:{sdp:t,id:2}})),console.log("send ice candidates by 2"))},t.onconnectionstatechange=()=>{console.log("reciever pc state => "+t.connectionState)},y.current=t),await t.setRemoteDescription(e);let r=await t.createAnswer();await t.setLocalDescription(r),n.send(JSON.stringify({type:a.ANSWER,payload:{answer:r}})),console.log("answer sent")}async function T(e){if(!g.current)return void console.log("no senderPc");await g.current.setRemoteDescription(e),console.log("remote answer set")}async function R(e,n){1==n&&y.current?(await y.current.addIceCandidate(e),console.log("ice candidates set for reciever")):g.current?(await g.current.addIceCandidate(e),console.log("ice candidates set for sender")):console.log("ice candidate mein gadbadi")}async function C(){if(d)return d;let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return u(e),e}function A(r){return S.current?e&&r==a.FIND_NEXT?void console.log("already i lobby"):void(e&&r==a.SKIP&&n(!1),n(!0),!t&&o(!0),g.current&&p(g.current),y.current&&p(y.current),g.current=null,y.current=null,S.current.send(JSON.stringify({type:a.FIND_NEXT,payload:{message:"something"}})),console.log("finding next... ")):void console.log("websocket not initialized")}return(0,s.useEffect)(()=>{!N.current&&i.current&&C().then(e=>{i.current&&e&&(i.current.srcObject=e,i.current.play(),N.current=!0)})},[i.current]),(0,s.useEffect)(()=>{if(!S.current||S.current.readyState==S.current.CLOSED){var e;let n=new WebSocket("wss://omicron-video-conferencing-application.onrender.com");S.current=n,(e=n).onmessage=n=>{let t=JSON.parse(n.data.toString()),r=t.type;if(r==c.MATCHED)D(e);else if(r==a.OFFER)w(t.payload.offer,e);else if(r==a.ADD_ICE_CANDIDATES){let e=t.payload.sdp,n=t.payload.id;e&&n&&R(e,n)}else r==a.ANSWER?T(t.payload.answer):r==a.SKIP?m():console.log(t)}}},[S.current]),(0,s.useEffect)(()=>{y&&l.current&&f&&(l.current.srcObject=f,l.current.muted=!1,l.current.play())},[y.current,l.current,f]),(0,s.useEffect)(()=>{d||C()},[d]),(0,r.jsxs)("div",{className:"relative min-h-screen min-w-screen h-screen w-screen bg-neutral-200 ",children:[(0,r.jsxs)("div",{className:"relative h-3/4 flex bg-green-400 justify-between items-center",children:[(0,r.jsx)("div",{className:"h-[90%] w-[49%] bg-red-500 m-4 rounded-2xl",children:(0,r.jsx)("video",{ref:l,playsInline:!0,className:"h-full w-full"})}),(0,r.jsx)("div",{className:" h-[90%] w-[49%]  bg-red-500 m-4 rounded-2xl",children:(0,r.jsx)("video",{ref:i,muted:!0,playsInline:!0,className:"h-full transform scale-x-[-1]"})})]}),(0,r.jsxs)("div",{className:"w-full py-2 px-4 flex gap-4 bg-blue-400",children:[(0,r.jsx)("div",{className:"h-15 w-30 py-2 rounded-2xl bg-neutral-400 flex justify-center items-center active:scale-90",onClick:()=>A(a.FIND_NEXT),children:t?"NEXT":"START"}),(0,r.jsx)("div",{className:"h-15 w-30 py-2 rounded-2xl bg-neutral-400 flex justify-center items-center active:scale-90",onClick:()=>{},children:"STOP"})]})]})}},2828:(e,n,t)=>{Promise.resolve().then(t.bind(t,455))}},e=>{var n=n=>e(e.s=n);e.O(0,[441,684,358],()=>n(2828)),_N_E=e.O()}]);