{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raman/OneDrive/Desktop/Desktop/projects/omegle/omicron-client/app/chat/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function Page() {\r\n  const localRef = useRef<HTMLVideoElement | null>(null);\r\n  const remoteRef = useRef<HTMLVideoElement | null>(null);\r\n\r\n  const [socket, setSocket] = useState<WebSocket | null>(null);\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null);\r\n\r\n  // store ICE candidates that arrive before remote description is set\r\n  const pendingCandidates = useRef<RTCIceCandidateInit[]>([]);\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket(\"ws://localhost:8080\");\r\n    setSocket(ws);\r\n\r\n    const pc = new RTCPeerConnection({\r\n      iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\r\n    });\r\n    setPc(pc);\r\n\r\n    // ðŸ”¹ Local stream\r\n    getStream(pc);\r\n\r\n    // ðŸ”¹ Handle remote tracks\r\n    pc.ontrack = (event) => {\r\n      if (remoteRef.current) {\r\n        let stream = remoteRef.current.srcObject as MediaStream;\r\n        if (!stream) {\r\n          stream = new MediaStream();\r\n          remoteRef.current.srcObject = stream;\r\n        }\r\n        stream.addTrack(event.track);\r\n      }\r\n    };\r\n\r\n    // ðŸ”¹ Send ICE candidates\r\n    pc.onicecandidate = (event) => {\r\n      if (event.candidate && ws.readyState === WebSocket.OPEN) {\r\n        ws.send(\r\n          JSON.stringify({\r\n            type: \"CANDIDATE\",\r\n            payload: event.candidate,\r\n          })\r\n        );\r\n      }\r\n    };\r\n\r\n    // ðŸ”¹ WebSocket listener\r\n    ws.onmessage = async (msg) => {\r\n      const data = JSON.parse(msg.data);\r\n\r\n      if (data.type === \"OFFER\") {\r\n        const desc = new RTCSessionDescription(data.payload);\r\n        await pc.setRemoteDescription(desc);\r\n\r\n        // add queued ICE candidates\r\n        for (const c of pendingCandidates.current) {\r\n          await pc.addIceCandidate(new RTCIceCandidate(c));\r\n        }\r\n        pendingCandidates.current = [];\r\n\r\n        const answer = await pc.createAnswer();\r\n        await pc.setLocalDescription(answer);\r\n\r\n        ws.send(JSON.stringify({ type: \"ANSWER\", payload: answer }));\r\n      } else if (data.type === \"ANSWER\") {\r\n        const desc = new RTCSessionDescription(data.payload);\r\n        await pc.setRemoteDescription(desc);\r\n\r\n        // add queued ICE candidates\r\n        for (const c of pendingCandidates.current) {\r\n          await pc.addIceCandidate(new RTCIceCandidate(c));\r\n        }\r\n        pendingCandidates.current = [];\r\n      } else if (data.type === \"CANDIDATE\") {\r\n        const candidate = data.payload;\r\n        if (pc.remoteDescription) {\r\n          try {\r\n            await pc.addIceCandidate(new RTCIceCandidate(candidate));\r\n          } catch (err) {\r\n            console.error(\"ICE add error:\", err);\r\n          }\r\n        } else {\r\n          // queue candidate until remoteDescription is set\r\n          pendingCandidates.current.push(candidate);\r\n        }\r\n      } else if (data.type === \"MATCHED\") {\r\n        console.log(\"Matched, sending offer...\");\r\n        sendOffer(pc, ws);\r\n      }\r\n    };\r\n\r\n    return () => {\r\n      pc.close();\r\n      ws.close();\r\n    };\r\n  }, []);\r\n\r\n  async function getStream(pc: RTCPeerConnection) {\r\n    const stream = await navigator.mediaDevices.getUserMedia({\r\n      video: true,\r\n      audio: true,\r\n    });\r\n    stream.getTracks().forEach((track) => pc.addTrack(track, stream));\r\n\r\n    if (localRef.current) {\r\n      localRef.current.srcObject = stream;\r\n      await localRef.current.play();\r\n    }\r\n  }\r\n\r\n  async function sendOffer(pc: RTCPeerConnection, ws: WebSocket) {\r\n    const offer = await pc.createOffer();\r\n    await pc.setLocalDescription(offer);\r\n    ws.send(JSON.stringify({ type: \"OFFER\", payload: offer }));\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex justify-center items-center h-screen w-screen gap-4\">\r\n      <div>\r\n        <video\r\n          ref={localRef}\r\n          autoPlay\r\n          muted\r\n          playsInline\r\n          className=\"w-80 h-60 bg-black\"\r\n        />\r\n        <p className=\"text-center mt-1\">Local</p>\r\n      </div>\r\n      <div>\r\n        <video\r\n          ref={remoteRef}\r\n          autoPlay\r\n          playsInline\r\n          className=\"w-80 h-60 bg-black\"\r\n        />\r\n        <p className=\"text-center mt-1\">Remote</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAIe,SAAS;IACtB,MAAM,WAAW,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAA2B;IACjD,MAAM,YAAY,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAA2B;IAElD,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAoB;IACvD,MAAM,CAAC,IAAI,MAAM,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAA4B;IAEvD,oEAAoE;IACpE,MAAM,oBAAoB,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAyB,EAAE;IAE1D,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,KAAK,IAAI,UAAU;QACzB,UAAU;QAEV,MAAM,KAAK,IAAI,kBAAkB;YAC/B,YAAY;gBAAC;oBAAE,MAAM;gBAA+B;aAAE;QACxD;QACA,MAAM;QAEN,kBAAkB;QAClB,UAAU;QAEV,0BAA0B;QAC1B,GAAG,OAAO,GAAG,CAAC;YACZ,IAAI,UAAU,OAAO,EAAE;gBACrB,IAAI,SAAS,UAAU,OAAO,CAAC,SAAS;gBACxC,IAAI,CAAC,QAAQ;oBACX,SAAS,IAAI;oBACb,UAAU,OAAO,CAAC,SAAS,GAAG;gBAChC;gBACA,OAAO,QAAQ,CAAC,MAAM,KAAK;YAC7B;QACF;QAEA,yBAAyB;QACzB,GAAG,cAAc,GAAG,CAAC;YACnB,IAAI,MAAM,SAAS,IAAI,GAAG,UAAU,KAAK,UAAU,IAAI,EAAE;gBACvD,GAAG,IAAI,CACL,KAAK,SAAS,CAAC;oBACb,MAAM;oBACN,SAAS,MAAM,SAAS;gBAC1B;YAEJ;QACF;QAEA,wBAAwB;QACxB,GAAG,SAAS,GAAG,OAAO;YACpB,MAAM,OAAO,KAAK,KAAK,CAAC,IAAI,IAAI;YAEhC,IAAI,KAAK,IAAI,KAAK,SAAS;gBACzB,MAAM,OAAO,IAAI,sBAAsB,KAAK,OAAO;gBACnD,MAAM,GAAG,oBAAoB,CAAC;gBAE9B,4BAA4B;gBAC5B,KAAK,MAAM,KAAK,kBAAkB,OAAO,CAAE;oBACzC,MAAM,GAAG,eAAe,CAAC,IAAI,gBAAgB;gBAC/C;gBACA,kBAAkB,OAAO,GAAG,EAAE;gBAE9B,MAAM,SAAS,MAAM,GAAG,YAAY;gBACpC,MAAM,GAAG,mBAAmB,CAAC;gBAE7B,GAAG,IAAI,CAAC,KAAK,SAAS,CAAC;oBAAE,MAAM;oBAAU,SAAS;gBAAO;YAC3D,OAAO,IAAI,KAAK,IAAI,KAAK,UAAU;gBACjC,MAAM,OAAO,IAAI,sBAAsB,KAAK,OAAO;gBACnD,MAAM,GAAG,oBAAoB,CAAC;gBAE9B,4BAA4B;gBAC5B,KAAK,MAAM,KAAK,kBAAkB,OAAO,CAAE;oBACzC,MAAM,GAAG,eAAe,CAAC,IAAI,gBAAgB;gBAC/C;gBACA,kBAAkB,OAAO,GAAG,EAAE;YAChC,OAAO,IAAI,KAAK,IAAI,KAAK,aAAa;gBACpC,MAAM,YAAY,KAAK,OAAO;gBAC9B,IAAI,GAAG,iBAAiB,EAAE;oBACxB,IAAI;wBACF,MAAM,GAAG,eAAe,CAAC,IAAI,gBAAgB;oBAC/C,EAAE,OAAO,KAAK;wBACZ,QAAQ,KAAK,CAAC,kBAAkB;oBAClC;gBACF,OAAO;oBACL,iDAAiD;oBACjD,kBAAkB,OAAO,CAAC,IAAI,CAAC;gBACjC;YACF,OAAO,IAAI,KAAK,IAAI,KAAK,WAAW;gBAClC,QAAQ,GAAG,CAAC;gBACZ,UAAU,IAAI;YAChB;QACF;QAEA,OAAO;YACL,GAAG,KAAK;YACR,GAAG,KAAK;QACV;IACF,GAAG,EAAE;IAEL,eAAe,UAAU,EAAqB;QAC5C,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;YACvD,OAAO;YACP,OAAO;QACT;QACA,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,QAAU,GAAG,QAAQ,CAAC,OAAO;QAEzD,IAAI,SAAS,OAAO,EAAE;YACpB,SAAS,OAAO,CAAC,SAAS,GAAG;YAC7B,MAAM,SAAS,OAAO,CAAC,IAAI;QAC7B;IACF;IAEA,eAAe,UAAU,EAAqB,EAAE,EAAa;QAC3D,MAAM,QAAQ,MAAM,GAAG,WAAW;QAClC,MAAM,GAAG,mBAAmB,CAAC;QAC7B,GAAG,IAAI,CAAC,KAAK,SAAS,CAAC;YAAE,MAAM;YAAS,SAAS;QAAM;IACzD;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;;kCACC,8OAAC;wBACC,KAAK;wBACL,QAAQ;wBACR,KAAK;wBACL,WAAW;wBACX,WAAU;;;;;;kCAEZ,8OAAC;wBAAE,WAAU;kCAAmB;;;;;;;;;;;;0BAElC,8OAAC;;kCACC,8OAAC;wBACC,KAAK;wBACL,QAAQ;wBACR,WAAW;wBACX,WAAU;;;;;;kCAEZ,8OAAC;wBAAE,WAAU;kCAAmB;;;;;;;;;;;;;;;;;;AAIxC","debugId":null}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raman/OneDrive/Desktop/Desktop/projects/omegle/omicron-client/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":";AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,uBAA2B,EAAF;;IAczC,OAAO;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;YAEP;QACF,OAAO;;QAMP;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raman/OneDrive/Desktop/Desktop/projects/omegle/omicron-client/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,4HAAyBC,QAAQ,CACxD,YACD,CAACC,kBAAkB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raman/OneDrive/Desktop/Desktop/projects/omegle/omicron-client/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored['react-ssr'].React\n"],"names":["module","exports","require","vendored","React"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,4HAAyBC,QAAQ,CAAC,YAAY,CAACC,KAAK","ignoreList":[0],"debugId":null}}]
}